nextflow.enable.moduleBinaries = true
process.cache = "lenient"

params {
    publish_dir_mode = "copy"
    debug = false
    outdir = "${baseDir}/results"
    trace_timestamp = new java.util.Date().format( 'yyyy-MM-dd_HH-mm-ss')
    author = "John Doe"
    kraken2_cpus = 30
    kraken2_memory = 10
}



env {
    PYTHONDONTWRITEBYTECODE=1
}



report {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_report_${params.trace_timestamp}.html"
    overwrite = true
}

timeline {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_timeline_${params.trace_timestamp}.html"
    overwrite = true
}

dag {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_dag_${params.trace_timestamp}.html"
    overwrite = true
    verbose = true
}

profiles {
    standard {
        includeConfig './conf/params.config'
        includeConfig "./conf/tower_defaults.config"
        includeConfig "./conf/perf.config"
        includeConfig "./conf/modules.config"
        docker {
            enabled    = true
            runOptions = '-u $(id -u):$(id -g)'
        }
    }
    stub {
        docker.enabled = false
        conda.enabled = false
        includeConfig './conf/params.config'
        includeConfig "./conf/perf.config"
        process {
            cpus = 1
            memory = "1 GB"
        }
    }
    gcp {
        includeConfig "conf/params.gcp.config"
        includeConfig "conf/tower_defaults.config"
        includeConfig "conf/perf.config"
        includeConfig "conf/gcp.config"
        docker {
            enabled    = true
            runOptions = '-u $(id -u):$(id -g)'
        }
        workDir = "${params.WORKDIR}"
        process {
            executor = 'google-batch'
            errorStrategy = { task.exitStatus==50001 ? 'retry' : 'terminate' }
            maxRetries = 3
        }
        google {
            project = params.PROJECT
            location = params.REGION
            batch.spot = params.spot
        }
    }
}

manifest {
   name        = 'WESQL'
   description = 'This pipeline is designed to whole exome sequencing quality control.'
   author      = 'Vin√≠cius Castro Santos'
   version     = '1.0'
}
